<html>
    <head>
    </head>
    <body>
<canvas id="c"></canvas>
<script src="client/spider.js"></script>
<script>
    let c = document.getElementById('c');
    c.width = window.innerWidth-50;
    c.height = window.innerHeight-50;
    let ctx = c.getContext('2d');

    let spider2 = new Spider2(300,300);

    let timer = 1;
    let idleTimer = 0;
    let target = {x: 10, y:10};
    let currentTarget = {x:target.x, y:target.y};
    let daSpider = new Spider(200, 400);
    let progress = 0;
    //let dists = getDistancesBetweenPoints(lols);
    addEventListener("mousemove", (e) => {
        target.x = e.clientX;
        target.y = e.clientY;

    })


    let keysDown = new Set();
    let pressKey = (key) => {
        keysDown.add(key);
    }
    let releaseKey = (key) => {
        keysDown.delete(key);
    };

    addEventListener("keydown", (e) => {
        pressKey(e.key);
    }, false);

    addEventListener("keyup", (e) => {
        releaseKey(e.key);
    }, false)
    

    let gameLoop = () => {
      //timer--;
      idleTimer+=0.1;
      if(idleTimer>2*Math.PI) {
        idleTimer =0;
      }
      if(timer === 0) {
        if(keysDown.has("ArrowRight")) {
          keysDown.delete("ArrowRight");
          keysDown.add("ArrowLeft");
        } else if (keysDown.has("ArrowLeft")){
          keysDown.delete("ArrowLeft");
          keysDown.add("ArrowRight");
        } else {
          keysDown.add("ArrowRight");

        }
        timer = 100;
      }

      if(keysDown.has("ArrowLeft")) {
        daSpider.move2(daSpider.x()-3, daSpider.y());
        lols[0].x-=2;
      }
      if(keysDown.has("ArrowRight")) {
        //daSpider.move2(daSpider.x()+3, daSpider.y());
        lols[0].x+=2;
      }
      if(keysDown.has("ArrowUp")) {
        daSpider.move2(daSpider.x(), daSpider.y()-2);
        lols[0].y-=2;
      }
      if(keysDown.has("ArrowDown")){
        //daSpider.move2(400,400);
        daSpider.move2(daSpider.x(), daSpider.y()+2);
        lols[0].y+=2;
      }
      if(distance(currentTarget, target) > 4) {
        currentTarget.x = lerp(currentTarget.x, target.x, easeOutQuad(progress));
        currentTarget.y = lerp(currentTarget.y, target.y, easeOutQuad(progress));
        progress = progress >= 1 ? 1 : progress+0.01;
      } else {
        progress = 0;
      }

      for(let i = 0; i < spider2.arms.length; i++) {
        fabrik(spider2.arms[i], spider2.distances[i], currentTarget);
      }
      //fabrik(lols2, dists, currentTarget) 




      ctx.fillStyle = "#fff";
      ctx.fillRect(0,0,c.width, c.height);
      ctx.fillStyle = "#aaa";
      ctx.fillRect(0,400,1000,50);
      ctx.fillRect(currentTarget.x, currentTarget.y, 5,5);
      ctx.fillRect(spider2.body.x, spider2.body.y, 5,5);

      spider2.arms.forEach(arm => {
        ctx.beginPath();
        arm.forEach(joint => {
          ctx.lineTo(joint.x, joint.y);
        });
        ctx.stroke();
      });
      //daSpider.update();
      //daSpider.render(ctx,0,0)
      /*ctx.beginPath();
      lols.forEach(l => {
        ctx.lineTo(l.x,l.y);
        ctx.fillRect(l.x,l.y,4,4)});
      ctx.stroke();
      ctx.beginPath();
      lols2.forEach(l => {
        ctx.lineTo(l.x,l.y);
        ctx.fillRect(l.x,l.y,4,4)});
      ctx.stroke();*/
      setTimeout(gameLoop, 20);
    }

    gameLoop();
    </script>
    </body>
</html>

