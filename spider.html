<html>
    <head>
    </head>
    <body>
<canvas id="c"></canvas>
<script src="client/spider.js"></script>
<script>
    let c = document.getElementById('c');
    c.width = window.innerWidth-50;
    c.height = window.innerHeight-50;
    let ctx = c.getContext('2d');

    let lols = [
      {x:100, y:100}, 
      {x:120, y:120},
      {x:150, y:120},
      {x:200, y:200},
      {x:220, y:240}];

    let timer = 1;
    let idleTimer = 0;
    let target = {x: 10, y:10};
    let daSpider = new Spider(200, 400);

    let dists = getDistancesBetweenPoints(lols);
    addEventListener("mousemove", (e) => {
        target.x = e.clientX;
        target.y = e.clientY;
        
    })


    let keysDown = new Set();
    let pressKey = (key) => {
        keysDown.add(key);
    }
    let releaseKey = (key) => {
        keysDown.delete(key);
    };

    addEventListener("keydown", (e) => {
        pressKey(e.key);
    }, false);

    addEventListener("keyup", (e) => {
        releaseKey(e.key);
    }, false)
    

    let gameLoop = () => {
      //timer--;
      idleTimer+=0.1;
      if(idleTimer>2*Math.PI) {
        idleTimer =0;
      }
      if(timer === 0) {
        if(keysDown.has("ArrowRight")) {
          keysDown.delete("ArrowRight");
          keysDown.add("ArrowLeft");
        } else if (keysDown.has("ArrowLeft")){
          keysDown.delete("ArrowLeft");
          keysDown.add("ArrowRight");
        } else {
          keysDown.add("ArrowRight");

        }
        timer = 100;
      }

      if(keysDown.has("ArrowLeft")) {
        daSpider.move2(daSpider.x()-3, daSpider.y());
      }
      if(keysDown.has("ArrowRight")) {
        daSpider.move2(daSpider.x()+3, daSpider.y());
      }
      if(keysDown.has("ArrowUp")) {
        daSpider.move2(daSpider.x(), daSpider.y()-2);
      }
      if(keysDown.has("ArrowDown")){
        //daSpider.move2(400,400);
        daSpider.move2(daSpider.x(), daSpider.y()+2);
      }

        fabrik(lols, dists, target);
      //daSpider.move2(daSpider.x(), daSpider.y()+0.8*Math.sin(idleTimer));




      ctx.fillStyle = "#fff";
      ctx.fillRect(0,0,c.width, c.height);
      ctx.fillStyle = "#aaa";
      ctx.fillRect(0,400,1000,50);
      //daSpider.update();
      //daSpider.render(ctx,0,0)
      ctx.beginPath();
      lols.forEach(l => {
        ctx.lineTo(l.x,l.y);
        ctx.fillRect(l.x,l.y,4,4)});
      ctx.stroke();
      setTimeout(gameLoop, 20);
    }

    gameLoop();
    </script>
    </body>
</html>

